{% extends "base.html" %}
{% block content %}

<section class="card report-card">
  <!-- Brand bar -->
  <div class="report-brand">
    <div class="brand-left">
      <img class="logo" src="{{ url_for('static', filename='logo.png') }}" alt="Enviro Labs"/>
      <div class="brand-name">Enviro Labs LLC</div>
    </div>
    <div class="brand-title">Certificate of Analysis</div>
    <div class="brand-right">
      <div class="label">Email</div>
      <a href="mailto:support@envirolabsusa.com">support@envirolabsusa.com</a>
    </div>
  </div>

  <div class="report-header">
    <h1>Report for Lab ID: <span class="mono">{{ r.lab_id }}</span></h1>
    <div class="actions">
      <a class="button" href="javascript:history.back()">Back</a>
      <button class="button primary" onclick="window.print()">Print PDF</button>
    </div>
  </div>

  <!-- Client Information -->
  <h2 class="section-title">Client Information</h2>
  <div class="kv-grid">
    <div class="kv"><div class="k">Client</div><div class="v">{{ p.client_info.client or r.client or "" }}</div></div>
    <div class="kv"><div class="k">Phone</div><div class="v">{{ p.client_info.phone or "" }}</div></div>
    <div class="kv"><div class="k">Email</div><div class="v">{{ p.client_info.email or "support@envirolabsusa.com" }}</div></div>
    <div class="kv"><div class="k">Project Lead</div><div class="v">{{ p.client_info.project_lead or "" }}</div></div>
    <div class="kv span-2"><div class="k">Address</div><div class="v">{{ p.client_info.address or "" }}</div></div>
  </div>

  <!-- Sample Summary -->
  <h2 class="section-title">Sample Summary</h2>
  <div class="kv-grid">
    <div class="kv"><div class="k">Reported</div><div class="v">{{ p.sample_summary.reported }}</div></div>
    <div class="kv"><div class="k">Received Date</div><div class="v">{{ p.sample_summary.received_date }}</div></div>
    <div class="kv span-2"><div class="k">Sample Name</div><div class="v">{{ p.sample_summary.sample_name }}</div></div>
    <div class="kv"><div class="k">Prepared By</div><div class="v">{{ p.sample_summary.prepared_by }}</div></div>
    <div class="kv"><div class="k">Matrix</div><div class="v">{{ p.sample_summary.matrix }}</div></div>
    <div class="kv"><div class="k">Prepared Date</div><div class="v">{{ p.sample_summary.prepared_date }}</div></div>
    <div class="kv"><div class="k">ASIN (Identifier)</div><div class="v">{{ p.sample_summary.asin }}</div></div>
    <div class="kv"><div class="k">Product Weight (g)</div><div class="v">{{ p.sample_summary.product_weight_g }}</div></div>
    <div class="kv span-2"><div class="k">Qualifiers</div><div class="v">{{ p.sample_summary.qualifiers }}</div></div>
  </div>

  <!-- Sample Results (ALL analytes) -->
  <h2 class="section-title">Sample Results</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th>
        <th>Result</th>
        <th>MRL</th>
        <th>Units</th>
        <th>Dilution</th>
        <th>Analyzed</th>
        <th>Qualifier</th>
      </tr>
    </thead>
    <tbody>
      {% if p.sample_results_rows and p.sample_results_rows|length > 0 %}
        {% for row in p.sample_results_rows %}
        <tr>
          <td>{{ row.analyte }}</td>
          <td>{{ row.result }}</td>
          <td>{{ row.mrl }}</td>
          <td>{{ row.units }}</td>
          <td>{{ row.dilution }}</td>
          <td>{{ row.analyzed }}</td>
          <td>{{ row.qualifier }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td>{{ p.sample_results.analyte }}</td>
          <td>{{ p.sample_results.result }}</td>
          <td>{{ p.sample_results.mrl }}</td>
          <td>{{ p.sample_results.units }}</td>
          <td>{{ p.sample_results.dilution }}</td>
          <td>{{ p.sample_results.analyzed }}</td>
          <td>{{ p.sample_results.qualifier }}</td>
        </tr>
      {% endif %}
    </tbody>
  </table>

  <p class="final-note">
    <strong>ENVIRO LABS LLC</strong> • Email:
    <a href="mailto:support@envirolabsusa.com">support@envirolabsusa.com</a>
  </p>
  <p class="final-note">
    This is a complete final report. The information in this report only applies to the sample submitted in this
    work order. This analytical report must be reproduced in its entirety.
  </p>

  <!-- QC sections (kept as your single blocks) -->
  <h2 class="section-title">Method Blank</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ p.sample_results.analyte }}</td>
        <td>{{ p.sample_results.result }}</td>
        <td>{{ p.sample_results.mrl }}</td>
        <td>{{ p.sample_results.units }}</td>
        <td>{{ p.sample_results.dilution }}</td>
      </tr>
    </tbody>
  </table>

  <h2 class="section-title">Matrix Spike 1</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
        <th>Fortified Level</th><th>%REC</th><th>%REC Limits</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ p.sample_results.analyte }}</td>
        <td>{{ p.sample_results.result }}</td>
        <td>{{ p.sample_results.mrl }}</td>
        <td>{{ p.sample_results.units }}</td>
        <td>{{ p.sample_results.dilution }}</td>
        <td><!-- optional --></td>
        <td><!-- optional --></td>
        <td><!-- optional --></td>
      </tr>
    </tbody>
  </table>

  <h2 class="section-title">Matrix Spike Duplicate</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>Units</th><th>Dilution</th>
        <th>%REC</th><th>%REC Limits</th><th>%RPD</th><th>%RPD Limit</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ p.sample_results.analyte }}</td>
        <td>{{ p.sample_results.result }}</td>
        <td>{{ p.sample_results.units }}</td>
        <td>{{ p.sample_results.dilution }}</td>
        <td><!-- optional --></td>
        <td><!-- optional --></td>
        <td><!-- optional --></td>
        <td><!-- optional --></td>
      </tr>
    </tbody>
  </table>

  <!-- Review & signature -->
  <div class="review-strip">
    <div class="review-item">
      <div class="k">Reviewed by</div>
      <div class="v">&nbsp;</div>
    </div>
    <div class="review-item">
      <div class="k">Signature</div>
      <div class="sig-line"></div>
    </div>
  </div>

  <!-- Definitions & disclaimer -->
  <h2 class="section-title">Definitions and Remarks</h2>
  <ul class="defs">
    <li><strong>%REC</strong> – Percent Recovery</li>
    <li><strong>MRL</strong> – Minimum Reportable Level (aka LOQ)</li>
    <li><strong>ND</strong> – Not detected at or above the MRL</li>
    <li><strong>RPD</strong> – Relative Percent Difference</li>
    <li><strong>MS1</strong> – MS/MSD recoveries outside acceptance limits due to high source sample concentration; surrogates within criteria.</li>
    <li>Remaining sample(s) are disposed one month from final report date unless arranged otherwise.</li>
  </ul>

  <p class="disclaimer">
    <strong>Disclaimer</strong> — The results in this report are provided for informational purposes related to the
    consumer products analysis of BPS, PFAS, and related compounds. Findings are estimated quantities and intended solely
    for the client's use as requested. Results are based on data obtained during the experiment and are subject to method
    limitations. The laboratory assumes no responsibility for interpretation or use of these results beyond their
    analytical scope, nor for decisions taken based on this information. It is the client’s responsibility to ensure
    compliance with all applicable regulatory standards.
  </p>

  <p class="footer-address">Address: 18102 Sky Park Cir Suite G, Irvine, CA 92614 &nbsp;|&nbsp; Phone: (949) 892-1915</p>
</section>

{% endblock %}
