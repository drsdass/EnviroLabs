{% extends "base.html" %}
{% block content %}
<section class="card report-card">
    <div class="report-header">
        <h1>Report Details: {{ r.lab_id | default("") }}</h1>
    </div>

    <div class="section-title">Client Information</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Client</div><div class="v">{{ p.client_info.client }}</div></div>
        <div class="kv"><div class="k">Client Phone</div><div class="v">{{ p.client_info.phone }}</div></div>
        <div class="kv"><div class="k">Project Lead</div><div class="v">{{ p.client_info.project_lead }}</div></div>
        <div class="kv"><div class="k">Client Email</div><div class="v">{{ p.client_info.email }}</div></div>
        <div class="kv span-2"><div class="k">Client Address</div><div class="v">{{ p.client_info.address }}</div></div>
    </div>
    
    <div class="section-title">Sample Summary</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Lab ID</div><div class="v mono">{{ r.lab_id }}</div></div>
        <div class="kv"><div class="k">Sample Name (Product)</div><div class="v">{{ p.sample_summary.sample_name }}</div></div>
        <div class="kv"><div class="k">Received Date</div><div class="v">{{ p.sample_summary.received_date }}</div></div>
        <div class="kv"><div class="k">Reported Date</div><div class="v">{{ p.sample_summary.reported }}</div></div>
        <div class="kv"><div class="k">Matrix</div><div class="v">{{ p.sample_summary.matrix }}</div></div>
        <div class="kv"><div class="k">Prepared By</div><div class="v">{{ p.sample_summary.prepared_by }}</div></div>
        <div class="kv"><div class="k">Prepared Date</div><div class="v">{{ p.sample_summary.prepared_date }}</div></div>
        <div class="kv"><div class="k">Qualifiers</div><div class="v">{{ p.sample_summary.qualifiers }}</div></div>
        <div class="kv"><div class="k">ASIN (Identifier)</div><div class="v">{{ p.sample_summary.asin }}</div></div>
        <div class="kv"><div class="k">Product Weight (Grams)</div><div class="v">{{ p.sample_summary.product_weight_g }}</div></div>
    </div>

    <div class="section-title">Sample Results ({{ p.sample_results.analyte | default("Details") }})</div>
    
    {% if r.pdf_url %}
    <table class="table clean" style="margin-top: 10px;">
        <thead>
            <tr>
                <th>Analyte</th>
                <th>Result/Concentration</th>
            </tr>
        </thead>
        <tbody>
            {% set results = r.pdf_url.split(' | ') %}
            {% for item in results %}
                {% set parts = item.split(': ') %}
                {% if parts | length == 2 %}
                <tr>
                    <td>{{ parts[0] }}</td>
                    <td>{{ parts[1] }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="muted">No detailed analyte results found (Check upload file or ingestion logic).</p>
    {% endif %}

    <div class="section-title">QC: Method Blank (MB)</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Analyte</div><div class="v">{{ p.method_blank.analyte }}</div></div>
        <div class="kv"><div class="k">Result</div><div class="v">{{ p.method_blank.result }}</div></div>
        <div class="kv"><div class="k">MRL</div><div class="v">{{ p.method_blank.mrl }}</div></div>
        <div class="kv"><div class="k">Units</div><div class="v">{{ p.method_blank.units }}</div></div>
        <div class="kv"><div class="k">Dilution</div><div class="v">{{ p.method_blank.dilution }}</div></div>
    </div>

    <div class="section-title">QC: Matrix Spike 1 (MS1)</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Analyte</div><div class="v">{{ p.matrix_spike_1.analyte }}</div></div>
        <div class="kv"><div class="k">Result</div><div class="v">{{ p.matrix_spike_1.result }}</div></div>
        <div class="kv"><div class="k">MRL</div><div class="v">{{ p.matrix_spike_1.mrl }}</div></div>
        <div class="kv"><div class="k">Units</div><div class="v">{{ p.matrix_spike_1.units }}</div></div>
        <div class="kv"><div class="k">Dilution</div><div class="v">{{ p.matrix_spike_1.dilution }}</div></div>
        <div class="kv"><div class="k">Fortified Level</div><div class="v">{{ p.matrix_spike_1.fortified_level }}</div></div>
        <div class="kv"><div class="k">% Recovery (%REC)</div><div class="v">{{ p.matrix_spike_1.pct_rec }}</div></div>
        <div class="kv"><div class="k">%REC Limits</div><div class="v">{{ p.matrix_spike_1.pct_rec_limits }}</div></div>
    </div>
    
    <div class="section-title">QC: Matrix Spike Duplicate (MSD)</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Analyte</div><div class="v">{{ p.matrix_spike_dup.analyte }}</div></div>
        <div class="kv"><div class="k">Result</div><div class="v">{{ p.matrix_spike_dup.result }}</div></div>
        <div class="kv"><div class="k">Units</div><div class="v">{{ p.matrix_spike_dup.units }}</div></div>
        <div class="kv"><div class="k">Dilution</div><div class="v">{{ p.matrix_spike_dup.dilution }}</div></div>
        <div class="kv"><div class="k">% Recovery (%REC)</div><div class="v">{{ p.matrix_spike_dup.pct_rec }}</div></div>
        <div class="kv"><div class="k">%REC Limits</div><div class="v">{{ p.matrix_spike_dup.pct_rec_limits }}</div></div>
        <div class="kv"><div class="k">% RPD</div><div class="v">{{ p.matrix_spike_dup.pct_rpd }}</div></div>
        <div class="kv"><div class="k">% RPD Limit</div><div class="v">{{ p.matrix_spike_dup.pct_rpd_limit }}</div></div>
    </div>
    
</section>
{% endblock %}
