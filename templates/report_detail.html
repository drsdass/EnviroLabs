{% extends "base.html" %}
{% block content %}

<section class="card report-card">

  <!-- Brand bar -->
  <div class="report-brand">
    <div class="brand-left">
      <img src="{{ url_for('static', filename='logo.png') }}" class="logo" alt="Enviro Labs">
      <div class="brand-name">Enviro Labs LLC</div>
    </div>
    <div class="brand-title">Certificate of Analysis</div>
    <div class="brand-right">
      <div class="label">Email</div>
      <a href="mailto:support@envirolabsusa.com">support@envirolabsusa.com</a>
    </div>
  </div>

  <div class="report-header">
    <h1>Report for Lab ID: <span class="mono">{{ r.lab_id }}</span></h1>
    <div class="actions">
      <a class="button" href="javascript:history.back()">Back</a>
      <button class="button primary" onclick="window.print()">Print PDF</button>
    </div>
  </div>

  <!-- Client Information -->
  <h2 class="section-title">Client Information</h2>
  <div class="kv-grid">
    <div class="kv"><div class="k">Client</div><div class="v">{{ r.client }}</div></div>
    <div class="kv"><div class="k">Phone</div><div class="v">{{ r.phone }}</div></div>
    <div class="kv"><div class="k">Email</div><div class="v">{{ r.email or 'support@envirolabsusa.com' }}</div></div>
    <div class="kv"><div class="k">Project Lead</div><div class="v">{{ r.project_lead }}</div></div>
    <div class="kv span-2"><div class="k">Address</div><div class="v">{{ r.address }}</div></div>
  </div>

  <!-- Sample Summary -->
  <h2 class="section-title">Sample Summary</h2>
  <div class="kv-grid">
    <div class="kv"><div class="k">Reported</div><div class="v">{{ r.resulted_date.isoformat() if r.resulted_date else '' }}</div></div>
    <div class="kv"><div class="k">Received Date</div><div class="v">{{ r.collected_date.isoformat() if r.collected_date else '' }}</div></div>
    <div class="kv span-2"><div class="k">Sample Name</div><div class="v">{{ r.sample_name or r.lab_id }}</div></div>
    <div class="kv"><div class="k">Prepared By</div><div class="v">{{ r.prepared_by }}</div></div>
    <div class="kv"><div class="k">Matrix</div><div class="v">{{ r.matrix }}</div></div>
    <div class="kv"><div class="k">Prepared Date</div><div class="v">{{ r.prepared_date }}</div></div>
    <div class="kv"><div class="k">ASIN (Identifier)</div><div class="v">{{ r.asin }}</div></div>
    <div class="kv"><div class="k">Product Weight (g)</div><div class="v">{{ r.product_weight_g }}</div></div>
    <div class="kv span-2"><div class="k">Qualifiers</div><div class="v">{{ r.qualifiers }}</div></div>
  </div>

  <!-- Sample Results -->
  <h2 class="section-title">Sample Results</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th>
        <th>Result</th>
        <th>MRL</th>
        <th>Units</th>
        <th>Dilution</th>
        <th>Analyzed</th>
        <th>Qualifier</th>
      </tr>
    </thead>
    <tbody>
      {% for a in sample_rows %}
      <tr>
        <td>{{ a.analyte }}</td>
        <td>{{ a.result }}</td>
        <td>{{ a.mrl }}</td>
        <td>{{ a.units }}</td>
        <td>{{ a.dilution }}</td>
        <td>{{ a.analyzed }}</td>
        <td>{{ a.qualifier }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <p class="final-note">
    <strong>ENVIRO LABS LLC</strong> • Email:
    <a href="mailto:support@envirolabsusa.com">support@envirolabsusa.com</a>
  </p>
  <p class="final-note">
    This is a complete final report. The information in this report only applies to the sample submitted in this work order.
    This analytical report must be reproduced in its entirety.
  </p>

  <!-- Method Blank -->
  <h2 class="section-title">Method Blank</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
      </tr>
    </thead>
    <tbody>
      {% for a in mb_rows %}
      <tr>
        <td>{{ a.analyte }}</td>
        <td>{{ a.result }}</td>
        <td>{{ a.mrl }}</td>
        <td>{{ a.units }}</td>
        <td>{{ a.dilution }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Matrix Spike 1 -->
  <h2 class="section-title">Matrix Spike 1</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
        <th>Fortified Level</th><th>%REC</th><th>%REC Limits</th>
      </tr>
    </thead>
    <tbody>
      {% for a in ms1_rows %}
      <tr>
        <td>{{ a.analyte }}</td>
        <td>{{ a.result }}</td>
        <td>{{ a.mrl }}</td>
        <td>{{ a.units }}</td>
        <td>{{ a.dilution }}</td>
        <td>{{ a.fortified_level }}</td>
        <td>{{ a.pct_rec }}</td>
        <td>{{ a.pct_rec_limits }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Matrix Spike Duplicate -->
  <h2 class="section-title">Matrix Spike Duplicate</h2>
  <table class="table report-table">
    <thead>
      <tr>
        <th>Analyte</th><th>Result</th><th>Units</th><th>Dilution</th>
        <th>%REC</th><th>%REC Limits</th><th>%RPD</th><th>%RPD Limit</th>
      </tr>
    </thead>
    <tbody>
      {% for a in msd_rows %}
      <tr>
        <td>{{ a.analyte }}</td>
        <td>{{ a.result }}</td>
        <td>{{ a.units }}</td>
        <td>{{ a.dilution }}</td>
        <td>{{ a.pct_rec }}</td>
        <td>{{ a.pct_rec_limits }}</td>
        <td>{{ a.pct_rpd }}</td>
        <td>{{ a.pct_rpd_limit }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Review/signature area -->
  <div class="review-strip">
    <div class="review-item">
      <div class="k">Reviewed by</div>
      <div class="v">&nbsp;</div>
    </div>
    <div class="review-item">
      <div class="k">Signature</div>
      <div class="sig-line"></div>
    </div>
  </div>

  <!-- Definitions & disclaimer -->
  <h2 class="section-title">Definitions and Remarks</h2>
  <ul class="defs">
    <li><strong>%REC</strong> – Percent Recovery</li>
    <li><strong>MRL</strong> – Minimum Reporting Level (aka LOQ)</li>
    <li><strong>ND</strong> – Not detected at or above the MRL (or MDL when reported)</li>
    <li><strong>RPD</strong> – Relative Percent Difference</li>
  </ul>

  <p class="footer-address">Address: 18102 Sky Park Cir Suite G, Irvine, CA 92614 &nbsp;|&nbsp; Phone: (949) 892-1915</p>
</section>

{% endblock %}
