{% extends "base.html" %}
{% block content %}
<section class="card report-card">
    <div class="report-header">
        <h1>Report Details: {{ r.lab_id | default("") }}</h1>
    </div>

    <div class="section-title">Client Information</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Client</div><div class="v">{{ p.client_info.client }}</div></div>
        <div class="kv"><div class="k">Client Phone</div><div class="v">{{ p.client_info.phone }}</div></div>
        <div class="kv"><div class="k">Project Lead</div><div class="v">{{ p.client_info.project_lead }}</div></div>
        <div class="kv"><div class="k">Client Email</div><div class="v">{{ p.client_info.email }}</div></div>
        <div class="kv span-2"><div class="k">Client Address</div><div class="v">{{ p.client_info.address }}</div></div>
    </div>
    
    <div class="section-title">Sample Summary</div>
    <div class="kv-grid">
        <div class="kv"><div class="k">Lab ID</div><div class="v mono">{{ r.lab_id }}</div></div>
        <div class="kv"><div class="k">Sample Name (Product)</div><div class="v">{{ p.sample_summary.sample_name }}</div></div>
        <div class="kv"><div class="k">Received Date</div><div class="v">{{ p.sample_summary.received_date }}</div></div>
        <div class="kv"><div class="k">Reported Date</div><div class="v">{{ p.sample_summary.reported }}</div></div>
        <div class="kv"><div class="k">Matrix</div><div class="v">{{ p.sample_summary.matrix }}</div></div>
        <div class="kv"><div class="k">Prepared By</div><div class="v">{{ p.sample_summary.prepared_by }}</div></div>
        <div class="kv"><div class="k">Prepared Date</div><div class="v">{{ p.sample_summary.prepared_date }}</div></div>
        <div class="kv"><div class="k">Qualifiers</div><div class="v">{{ p.sample_summary.qualifiers }}</div></div>
        <div class="kv"><div class="k">ASIN (Identifier)</div><div class="v">{{ p.sample_summary.asin }}</div></div>
        <div class="kv"><div class="k">Product Weight (Grams)</div><div class="v">{{ p.sample_summary.product_weight_g }}</div></div>
    </div>

    <div class="section-title">Sample Results</div>
    
    {% if r.pdf_url %}
    <table class="table clean" style="margin-top: 10px;">
        <thead>
            <tr>
                <th>Analyte</th>
                <th>Result</th>
                <th>MRL</th>
                <th>Units</th>
                <th>Dilution</th>
                <th>Analyzed</th>
                <th>Qualifier</th>
            </tr>
        </thead>
        <tbody>
            {% set results = r.pdf_url.split(' | ') %}
            {% for item in results %}
                {% set parts = item.split(': ') %}
                {% if parts | length == 2 %}
                <tr>
                    <td>{{ parts[0] }}</td>
                    <td>{{ parts[1] }}</td>
                    <td>{{ p.sample_results.mrl }}</td>
                    <td>{{ p.sample_results.units }}</td>
                    <td>{{ p.sample_results.dilution }}</td>
                    <td>{{ p.sample_results.analyzed }}</td>
                    <td>{{ p.sample_results.qualifier }}</td>
                </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="muted">No detailed analyte results found (Check upload file or ingestion logic).</p>
    {% endif %}

    <div class="section-title" style="margin-top: 30px;">Quality Control Results</div>
    
    
    <div class="section-title" style="font-size: 1.1rem; margin-top: 20px;">Method Blank (MB)</div>
    <table class="table clean">
        <thead>
            <tr>
                <th>Analyte</th>
                <th>Result</th>
                <th>MRL</th>
                <th>Units</th>
                <th>Dilution</th>
                <th>Analyzed</th>
                <th>Qualifier</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ p.method_blank.analyte }}</td>
                <td>{{ p.method_blank.result }}</td>
                <td>{{ p.method_blank.mrl }}</td>
                <td>{{ p.method_blank.units }}</td>
                <td>{{ p.method_blank.dilution }}</td>
                <td>N/A</td> <td>N/A</td> 
            </tr>
        </tbody>
    </table>

    <div class="section-title" style="font-size: 1.1rem; margin-top: 20px;">Matrix Spike (MS)</div>
    <table class="table clean">
        <thead>
            <tr>
                <th>Analyte</th>
                <th>Result</th>
                <th>MRL</th>
                <th>Units</th>
                <th>Dilution</th>
                <th>Fortified Level</th>
                <th>%REC</th>
                <th>%REC Limits</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ p.matrix_spike_1.analyte }}</td>
                <td>{{ p.matrix_spike_1.result }}</td>
                <td>{{ p.matrix_spike_1.mrl }}</td>
                <td>{{ p.matrix_spike_1.units }}</td>
                <td>{{ p.matrix_spike_1.dilution }}</td>
                <td>{{ p.matrix_spike_1.fortified_level }}</td>
                <td>{{ p.matrix_spike_1.pct_rec }}</td>
                <td>{{ p.matrix_spike_1.pct_rec_limits }}</td>
            </tr>
        </tbody>
    </table>
    
    <div class="section-title" style="font-size: 1.1rem; margin-top: 20px;">Matrix Spike Duplicate (MSD)</div>
    <table class="table clean">
        <thead>
            <tr>
                <th>Analyte</th>
                <th>Result</th>
                <th>Units</th>
                <th>Dilution</th>
                <th>%REC</th>
                <th>%REC Limits</th>
                <th>%RPD</th>
                <th>%RPD Limit</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ p.matrix_spike_dup.analyte }}</td>
                <td>{{ p.matrix_spike_dup.result }}</td>
                <td>{{ p.matrix_spike_dup.units }}</td>
                <td>{{ p.matrix_spike_dup.dilution }}</td>
                <td>{{ p.matrix_spike_dup.pct_rec }}</td>
                <td>{{ p.matrix_spike_dup.pct_rec_limits }}</td>
                <td>{{ p.matrix_spike_dup.pct_rpd }}</td>
                <td>{{ p.matrix_spike_dup.pct_rpd_limit }}</td>
            </tr>
        </tbody>
    </table>
    
</section>
{% endblock %}
