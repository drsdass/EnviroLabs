{% extends "base.html" %}
{% block title %}Report ‚Äì {{ r.lab_id }}{% endblock %}

{% block content %}
<style>
  /* Minimal safety styles so the page prints nicely even if styles.css is empty */
  .report-wrap { max-width: 1000px; margin: 0 auto; background:#fff; padding: 24px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,.06); }
  .header { display:flex; align-items:center; gap:16px; border-bottom:1px solid #eee; padding-bottom:16px; margin-bottom:16px; }
  .header img { height:56px; width:auto; }
  .header h1 { margin:0; font-size:22px; }
  .small { color:#666; font-size:14px; }
  .actions { display:flex; gap:10px; margin: 10px 0 22px 0; }
  .btn { display:inline-block; padding:8px 12px; border:1px solid #ddd; background:#f7f7f7; border-radius:8px; text-decoration:none; color:#333; }
  .btn:hover { background:#f0f0f0; }
  h2 { font-size:18px; margin:18px 0 8px; }
  table { width:100%; border-collapse: collapse; margin-bottom: 14px; }
  th, td { border:1px solid #e6e6e6; padding:8px 10px; vertical-align: top; }
  th { background:#fafafa; text-align:left; }
  .note { background:#fcfcfc; border:1px solid #eee; padding:12px; border-radius:8px; margin:16px 0; }
  .footer { margin-top: 22px; font-size: 13px; color:#444; }
  @media print {
    .actions, .nav { display:none !important; }
    body { background:#fff; }
    .report-wrap { box-shadow:none; border:none; }
  }
</style>

<div class="report-wrap">
  <!-- Header -->
  <div class="header">
    <img src="{{ url_for('static', filename='logo.png') }}" alt="Enviro Labs Logo">
    <div>
      <h1>ENVIRO LABS LLC</h1>
      <div class="small">Email: <a href="mailto:support@envirolabsusa.com">support@envirolabsusa.com</a></div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions">
    <a class="btn" href="{{ url_for('dashboard') }}">‚Üê Back to Dashboard</a>
    <button class="btn" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
  </div>

  <!-- Summary heading -->
  <div class="note">
    <strong>Report for Lab ID:</strong> {{ r.lab_id }}{% if p.sample_summary.sample_name and p.sample_summary.sample_name != r.lab_id %} &nbsp;|&nbsp; <strong>Sample Name:</strong> {{ p.sample_summary.sample_name }}{% endif %}
    {% if p.sample_summary.reported %}&nbsp;|&nbsp;<strong>Reported:</strong> {{ p.sample_summary.reported }}{% endif %}
  </div>

  <!-- Client Information -->
  <h2>Client Information</h2>
  <table>
    <tr><th>Client</th><td>{{ p.client_info.client or r.client }}</td></tr>
    <tr><th>Phone</th><td>{{ p.client_info.phone }}</td></tr>
    <tr><th>Email</th><td>{{ p.client_info.email }}</td></tr>
    <tr><th>Project Lead</th><td>{{ p.client_info.project_lead }}</td></tr>
    <tr><th>Address</th><td>{{ p.client_info.address }}</td></tr>
  </table>

  <!-- Sample Summary -->
  <h2>Sample Summary</h2>
  <table>
    <tr>
      <th>Reported</th><td>{{ p.sample_summary.reported }}</td>
      <th>Received Date</th><td>{{ p.sample_summary.received_date }}</td>
    </tr>
    <tr>
      <th>Sample Name</th><td>{{ p.sample_summary.sample_name or r.lab_id }}</td>
      <th>Prepared By</th><td>{{ p.sample_summary.prepared_by }}</td>
    </tr>
    <tr>
      <th>Matrix</th><td>{{ p.sample_summary.matrix }}</td>
      <th>Prepared Date</th><td>{{ p.sample_summary.prepared_date }}</td>
    </tr>
    <tr>
      <th>Qualifiers</th><td>{{ p.sample_summary.qualifiers }}</td>
      <th>ASIN (Identifier)</th><td>{{ p.sample_summary.asin }}</td>
    </tr>
    <tr>
      <th>Product Weight (g)</th><td>{{ p.sample_summary.product_weight_g }}</td>
      <th></th><td></td>
    </tr>
  </table>

  <!-- Sample Results -->
  <h2>Sample Results</h2>
  <table>
    <tr>
      <th>Analyte</th>
      <th>Result</th>
      <th>MRL</th>
      <th>Units</th>
      <th>Dilution</th>
      <th>Analyzed</th>
      <th>Qualifier</th>
    </tr>
    <tr>
      <td>{{ p.sample_results.analyte or r.test }}</td>
      <td>{{ p.sample_results.result or r.result }}</td>
      <td>{{ p.sample_results.mrl }}</td>
      <td>{{ p.sample_results.units }}</td>
      <td>{{ p.sample_results.dilution }}</td>
      <td>{{ p.sample_results.analyzed }}</td>
      <td>{{ p.sample_results.qualifier }}</td>
    </tr>
  </table>

  <!-- ‚ÄúComplete final report‚Äù statement -->
  <div class="note">
    This is a complete final report. The information in this report only applies to the sample submitted in this work order.
    This analytical report must be reproduced in its entirety.
  </div>

  <!-- QC Sections -->
  <h2>Quality Control</h2>

  <h3>Method Blank</h3>
  <table>
    <tr>
      <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
    </tr>
    <tr>
      <td>{{ p.method_blank.analyte }}</td>
      <td>{{ p.method_blank.result }}</td>
      <td>{{ p.method_blank.mrl }}</td>
      <td>{{ p.method_blank.units }}</td>
      <td>{{ p.method_blank.dilution }}</td>
    </tr>
  </table>

  <h3>Matrix Spike 1</h3>
  <table>
    <tr>
      <th>Analyte</th><th>Result</th><th>MRL</th><th>Units</th><th>Dilution</th>
      <th>Fortified Level</th><th>%REC</th><th>%REC Limits</th>
    </tr>
    <tr>
      <td>{{ p.matrix_spike_1.analyte }}</td>
      <td>{{ p.matrix_spike_1.result }}</td>
      <td>{{ p.matrix_spike_1.mrl }}</td>
      <td>{{ p.matrix_spike_1.units }}</td>
      <td>{{ p.matrix_spike_1.dilution }}</td>
      <td>{{ p.matrix_spike_1.fortified_level }}</td>
      <td>{{ p.matrix_spike_1.pct_rec }}</td>
      <td>{{ p.matrix_spike_1.pct_rec_limits }}</td>
    </tr>
  </table>

  <h3>Matrix Spike Duplicate</h3>
  <table>
    <tr>
      <th>Analyte</th><th>Result</th><th>Units</th><th>Dilution</th>
      <th>%REC</th><th>%REC Limits</th><th>%RPD</th><th>%RPD Limit</th>
    </tr>
    <tr>
      <td>{{ p.matrix_spike_dup.analyte }}</td>
      <td>{{ p.matrix_spike_dup.result }}</td>
      <td>{{ p.matrix_spike_dup.units }}</td>
      <td>{{ p.matrix_spike_dup.dilution }}</td>
      <td>{{ p.matrix_spike_dup.pct_rec }}</td>
      <td>{{ p.matrix_spike_dup.pct_rec_limits }}</td>
      <td>{{ p.matrix_spike_dup.pct_rpd }}</td>
      <td>{{ p.matrix_spike_dup.pct_rpd_limit }}</td>
    </tr>
  </table>

  <!-- Reviewer / signature line -->
  <table style="margin-top: 18px;">
    <tr>
      <th style="width: 220px;">Reviewed by</th>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <th>Signature</th>
      <td style="height: 60px;">&nbsp;</td>
    </tr>
  </table>

  <!-- Definitions & Remarks -->
  <h2>Definitions and Remarks</h2>
  <table>
    <tr><th>%REC</th><td>Percent Recovery</td></tr>
    <tr><th>MRL</th><td>The minimum levels, concentrations, or quantities of a target variable (e.g., target analyte) that can be reported with a specified degree of confidence. The MRL is also known as Limit of Quantitation (LOQ).</td></tr>
    <tr><th>ND</th><td>NOT DETECTED at or above the Method Reporting Limit (MRL). If Method Detection Limit (MDL) is reported, then ND means not detected at or above the MDL.</td></tr>
    <tr><th>RPD</th><td>Relative Percent Difference</td></tr>
    <tr><th>MS1</th><td>The MS and/or MSD recoveries are outside the acceptance limits due to the source sample concentration being greater than 4 times the spike concentration. The surrogate recoveries are within acceptance criteria.</td></tr>
  </table>

  <div class="note">
    Any remaining sample(s) will be disposed of one month from the final report date unless other arrangements are made in advance.
  </div>

  <h2>Disclaimer</h2>
  <p class="small">
    The results detailed in this report are provided for informational purposes related to the consumer products analysis of BPS, PFAS, and other related compounds. These findings are estimated quantities and intended solely for the client's use as requested. All results, interpretations, and conclusions are based on the data obtained during the experiment and are subject to limitations inherent in the methods used. Any errors or inaccuracies are unintentional. The laboratory assumes no responsibility for the interpretation or use of these results beyond their analytical scope, nor for any decisions or actions taken based on this information. It is the client's responsibility to ensure compliance with all applicable regulatory standards.
  </p>

  <div class="footer">
    Address: 18102 Sky Park Cir Suite G, Irvine, CA 92614 &nbsp;|&nbsp; Phone: (949) 892-1915
  </div>
</div>
{% endblock %}
