{% extends "base.html" %}
{% block content %}

<section class="card">
  <h1>Filters</h1>
  <form class="form-grid" method="get" action="{{ url_for('dashboard') }}">
    <label>
      <span>Lab ID</span>
      <input class="input" type="text" name="lab_id" placeholder="Search by Lab ID" value="{{ request.args.get('lab_id','') }}">
    </label>
    <label>
      <span>Reported From</span>
      <input class="input" type="text" name="start" placeholder="YYYY-MM-DD or {{ (request.args.get('start') or '') }}">
    </label>
    <label>
      <span>Reported To</span>
      <input class="input" type="text" name="end" placeholder="YYYY-MM-DD or {{ (request.args.get('end') or '') }}">
    </label>
    <div class="form-actions">
      <button class="button primary" type="submit">Apply</button>
      <a class="button" href="{{ url_for('dashboard') }}">Clear</a>
    </div>
  </form>
</section>

{% if session.get('role') == 'admin' %}
<section class="card">
  <h1>Upload “Master Upload File” (CSV)</h1>
  <p class="muted">The app auto-detects and skips the banner row and reads duplicate headers (Analyte, Result, …). Internal standards (13C12 BPS / d8-BPS) are ignored. PFAS rows are limited to the 13 named analytes.</p>
  <form method="post" action="{{ url_for('upload_csv') }}" enctype="multipart/form-data" class="upload-row">
    <input class="file" type="file" name="csv_file" accept=".csv,.xlsx,.xls">
    <label class="check">
      <input type="checkbox" name="keep_original" checked> Keep uploaded file on disk
    </label>
    <button class="button primary" type="submit">Import</button>
  </form>
</section>
{% endif %}

<section class="card">
  <h1>Reports</h1>

  {% if report_summaries and report_summaries|length > 0 %}
  <table class="table clean">
    <thead>
      <tr>
        <th>Lab ID</th>
        <th>Client</th>
        <th>Sample Name</th>
        <th>Analyte</th>
        <th>Result</th>
        <th>Units</th>
        <th>Reported</th>
      </tr>
    </thead>
    <tbody>
      {% for s in report_summaries %}
      <tr>
        <td><a class="link" href="{{ url_for('report_detail', report_id=s.report_id) }}">{{ s.lab_id }}</a></td>
        <td>{{ s.client }}</td>
        <td>{{ s.sample_name }}</td>
        <td>{{ s.analyte }}</td>
        <td>{{ s.result }}</td>
        <td>{{ s.units }}</td>
        <td>{{ s.reported }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="muted">No reports yet.</p>
  {% endif %}
</section>

{% endblock %}
